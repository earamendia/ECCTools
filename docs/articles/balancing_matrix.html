<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the balancing matrix • ECCTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the balancing matrix">
<meta property="og:description" content="ECCTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ECCTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ECCTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/balancing_matrix.html">Using the balancing matrix</a>
    </li>
    <li>
      <a href="../articles/transform_to_bta.html">Bilateral Trade Assumption</a>
    </li>
    <li>
      <a href="../articles/transform_to_dta.html">Domestic Technology Assumption</a>
    </li>
    <li>
      <a href="../articles/transform_to_gma.html">Global Market Assumption</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="balancing_matrix_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the balancing matrix</h1>
            
      
      
      <div class="hidden name"><code>balancing_matrix.Rmd</code></div>

    </div>

    
    
<p>In this vignette we show how to use the balancing matrix <strong>B</strong> to modify the Energy Conversion Chain.</p>
<div id="introduction-and-use-of-the-balancing-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-and-use-of-the-balancing-matrix" class="anchor"></a>Introduction and use of the balancing matrix</h1>
<div id="the-balancing-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#the-balancing-matrix" class="anchor"></a>The balancing matrix</h2>
<p>The balancing matrix is an extension of the original Physical Supply Use Table (PSUT) framework (see <span class="citation">@Heun:2018</span>) and has been introduced in a work presently under review. The figure below shows the expanded PSUT framework with the balancing <strong>B</strong> matrix.</p>
<p><img src="figs/psut_expanded.png"></p>
<p><strong>Warning</strong>: Before detailing further the use of the balancing matrix, the user needs to be aware that its use complexifies the conduction of downstream Input-Output analysis (for instance with the <code>Recca</code> package). Indeed, by relocating flows to the balancing matrix, one is changing the definition of the matrices and vectors structuring the PSUT. Vectors may then be defined differently with a supply and with a consumption perspective. So, while the use of the <strong>B</strong> matrix may prove helpful, we recommend its use only if the implications of the given use are fully understood. We also recommend reading the paper that introduces the <strong>B</strong> matrix <span class="citation">@mr_psut_paper</span>.</p>
<p>The <strong>B</strong> matrix enables analysts to:</p>
<ul>
<li>modify the supply mix while conserving energy balance;</li>
<li>modify the final demand while conserving energy balance.</li>
</ul>
<p>To scale up or down the supply of a given industry <em>i</em> by a factor <span class="math inline">\(\lambda\)</span>, one can proceed according to the table below, extracted from <span class="citation">@mr_psut_paper</span> .</p>
<p><img src="figs/table_2.png"></p>
<p>To modify the final demand without loosing energy balance, one can simply redirect energy flows belonging to the final demand (<strong>Y</strong> matrix) to the balancing matrix <strong>B</strong>.</p>
</div>
<div id="using-the-balancing-b-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-balancing-b-matrix" class="anchor"></a>Using the balancing B matrix</h2>
<div id="initialising-data" class="section level3">
<h3 class="hasAnchor">
<a href="#initialising-data" class="anchor"></a>Initialising data</h3>
<p>Let us use the AB world example introduced in the <a href="">Get started</a> vignette, but let us add flows, so that:</p>
<ol style="list-style-type: decimal">
<li>Statistical differences provide 100 ktoe of crude oil in country A. To keep balance between supply and use, we assume that these 100 ktoe are consumed by a submarine race organised in country A.</li>
<li>Stock changes provide 400 ktoe of coke oven coke in country B. To keep balance between supply and use, we assume that these 400 ktoe are consumed by the organisation of large bonfires in country B, and that coke oven coke is an excellent fuel for bonfires.</li>
<li>Stock changes consume 200 ktoe of coke oven coke in country A, which importations are actually 800 ktoe and not 600 ktoe! Hence that final demand contributes to the build-up of country A stocks, and will be used later on, when country A lacks coke oven coke.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fix product-level balances within each country</span>
<span class="va">tidy_AB_data_added_flows</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_data</span> <span class="op">%&gt;%</span> 
  <span class="co"># First, adding statistical differences providing 100 ktoe of crude oil in country A:</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"A"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Supply"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"TFC compare"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Statistical differences"</span>, Product <span class="op">=</span> <span class="st">"Crude oil"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Second, adding the submarine race organised in country A:</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"A"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Consumption"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"Industry"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Submarine race"</span>, Product <span class="op">=</span> <span class="st">"Crude oil"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Third, adding the stock changes supplying 400 ktoe of coke oven coke in country B:</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"B"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Supply"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"Total primary energy supply"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Stock changes"</span>, Product <span class="op">=</span> <span class="st">"Coke oven coke"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="op">-</span><span class="fl">400</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Fourth, adding the bonfire sessions in country B:</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"B"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Consumption"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"Industry"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Bonfires"</span>, Product <span class="op">=</span> <span class="st">"Coke oven coke"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="fl">400</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Fifth, adding stock build-up of 200 ktoe of coke oven coke in country A</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"A"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Supply"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"Total primary energy supply"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Stock changes"</span>, Product <span class="op">=</span> <span class="st">"Coke oven coke"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Sixth, adding imports of 200 ktoe of coke oven coke by country A</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"A"</span>, Method <span class="op">=</span> <span class="st">"PCM"</span>, Energy.type <span class="op">=</span> <span class="st">"E"</span>, Last.stage <span class="op">=</span> <span class="st">"Final"</span>, Year <span class="op">=</span> <span class="fl">2018</span>, 
                  Ledger.side <span class="op">=</span> <span class="st">"Supply"</span>, Flow.aggregation.point <span class="op">=</span> <span class="st">"Total primary energy supply"</span>, 
                  Flow <span class="op">=</span> <span class="st">"Imports [of Coke oven coke]"</span>, Product <span class="op">=</span> <span class="st">"Coke oven coke"</span>, Unit <span class="op">=</span> <span class="st">"ktoe"</span>, E.dot <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 105 × 11
##    Country Method Energy.type Last.stage  Year Ledger.side Flow.aggregation.poi…
##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                
##  1 A       PCM    E           Final       2018 Consumption Industry             
##  2 A       PCM    E           Final       2018 Consumption Industry             
##  3 A       PCM    E           Final       2018 Consumption Industry             
##  4 A       PCM    E           Final       2018 Consumption Industry             
##  5 A       PCM    E           Final       2018 Consumption Industry             
##  6 A       PCM    E           Final       2018 Consumption Industry             
##  7 A       PCM    E           Final       2018 Consumption Other                
##  8 A       PCM    E           Final       2018 Consumption Other                
##  9 A       PCM    E           Final       2018 Consumption Other                
## 10 A       PCM    E           Final       2018 Consumption Other                
## # … with 95 more rows, and 4 more variables: Flow &lt;chr&gt;, Product &lt;chr&gt;,
## #   Unit &lt;chr&gt;, E.dot &lt;dbl&gt;</code></pre>
<p>We can now verify that the adjusted ECC remains balanced:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fix product-level balances within each country</span>
<span class="va">tidy_AB_data_added_flows</span> <span class="op">%&gt;%</span> 
  <span class="fu">IEATools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IEATools/man/tidy_iea_df_balanced.html">tidy_iea_df_balanced</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="relocating-flows-to-balancing-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#relocating-flows-to-balancing-matrix" class="anchor"></a>Relocating flows to balancing matrix</h3>
<p>Now, let’s assume that we want to modify the given ECC as follows:</p>
<ol style="list-style-type: decimal">
<li>Statistical differences do not contribute to the supply mix in reality. The fact that some energy products are provided by statistical differences hides the upstream conversion processes associated to these energy products. Hence, we want to <em>remove statistical differences from the supply mix</em>.</li>
<li>Stock changes may contribute to the supply mix in reality, in a given year. However, stock changes have been built (so, products have been produced) in previous years. Here we want to <em>remove stock changes from the supply mix</em> in order to simulate that the products drawn from stocks have been produced by the rest of the supply mix of the same year.</li>
<li>Stock changes appearing as final consumption (200 ktoe of coke oven coke in country A) are not really part of the final energy consumption in the given year, rather, they will be consumed in later years. Hence, we want to <em>remove stock changes from the final consumption</em>.</li>
</ol>
<p><strong>Note</strong>: Statistical differences and stock changes will not necessarily need to be relocated to the balancing <strong>B</strong> matrix. This is an option available to the analyst that we use here as example, which may prove appropriate in some situations and for some purposes.</p>
<p>We will make use of the following functions:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/IEATools/man/add_psut_matnames.html">IEATools::add_psut_matnames()</a></code> will add a column stating the matrix to which each flow belongs (function belonging to the <code>IEATools</code> package);</li>
<li>
<code><a href="../reference/stat_diffs_to_balancing.html">stat_diffs_to_balancing()</a></code> will move statistical difference flows, whether they are supply or use flows, to the balancing <strong>B</strong> matrix;</li>
<li>
<code><a href="../reference/stock_changes_to_balancing.html">stock_changes_to_balancing()</a></code> will move stock changes flows, whether they are supply or use flows, to the balancing <strong>B</strong> matrix.</li>
</ul>
<p>The code is as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_AB_data_relocated_flows</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_data_added_flows</span> <span class="op">%&gt;%</span> 
  <span class="fu">IEATools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IEATools/man/add_psut_matnames.html">add_psut_matnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/stat_diffs_to_balancing.html">stat_diffs_to_balancing</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/stock_changes_to_balancing.html">stock_changes_to_balancing</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 105 × 12
##    Country Method Energy.type Last.stage  Year Ledger.side Flow.aggregation.poi…
##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                
##  1 A       PCM    E           Final       2018 Consumption Industry             
##  2 A       PCM    E           Final       2018 Consumption Industry             
##  3 A       PCM    E           Final       2018 Consumption Industry             
##  4 A       PCM    E           Final       2018 Consumption Industry             
##  5 A       PCM    E           Final       2018 Consumption Industry             
##  6 A       PCM    E           Final       2018 Consumption Industry             
##  7 A       PCM    E           Final       2018 Consumption Other                
##  8 A       PCM    E           Final       2018 Consumption Other                
##  9 A       PCM    E           Final       2018 Consumption Other                
## 10 A       PCM    E           Final       2018 Consumption Other                
## # … with 95 more rows, and 5 more variables: Flow &lt;chr&gt;, Product &lt;chr&gt;,
## #   Unit &lt;chr&gt;, E.dot &lt;dbl&gt;, matnames &lt;chr&gt;</code></pre>
<p>Now, we can see that the Statistical differences and Stock changes flows belong to the balancing <strong>B</strong> matrix:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_AB_data_relocated_flows</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">Flow</span>, <span class="st">"Statistical differences"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   Country Method Energy.type Last.stage  Year Ledger.side Flow.aggregatio… Flow 
##   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;
## 1 A       PCM    E           Final       2018 Supply      TFC compare      Stat…
## # … with 4 more variables: Product &lt;chr&gt;, Unit &lt;chr&gt;, E.dot &lt;dbl&gt;,
## #   matnames &lt;chr&gt;</code></pre>
<p>and:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_AB_data_relocated_flows</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">Flow</span>, <span class="st">"Stock changes"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 12
##   Country Method Energy.type Last.stage  Year Ledger.side Flow.aggregatio… Flow 
##   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;
## 1 B       PCM    E           Final       2018 Supply      Total primary e… Stoc…
## 2 A       PCM    E           Final       2018 Supply      Total primary e… Stoc…
## # … with 4 more variables: Product &lt;chr&gt;, Unit &lt;chr&gt;, E.dot &lt;dbl&gt;,
## #   matnames &lt;chr&gt;</code></pre>
<p>Finally, let’s verify that the Energy Conversion Chain remains balanced once flows are relocated to the balancing <strong>B</strong> matrix:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_AB_data_relocated_flows</span> <span class="op">%&gt;%</span> 
  <span class="fu">IEATools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IEATools/man/tidy_iea_df_balanced.html">tidy_iea_df_balanced</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><em>Note regarding the sign convention in the balancing matrix</em>: Flow appearing as positive in the <strong>B</strong> matrix are akin to final demand flows. For instance, final demand flows relocated to <strong>B</strong> will be positive, a build-up in energy products stocks will be positive. Conversely, flows akin to supply will be registered as negative in <strong>B</strong>: for instance, flows removed from supply, energy products drawn from stocks, will all appear as negative values.</p>
<p>In conclusion, the analyst may use directly some functions directly available, such as <code><a href="../reference/stat_diffs_to_balancing.html">stat_diffs_to_balancing()</a></code> and <code><a href="../reference/stock_changes_to_balancing.html">stock_changes_to_balancing()</a></code>. Alternatively, the analyst may directly relocate a flow to <strong>B</strong> by modifying the matrix name column of the flow that needs to be modified. Be careful with the sign convention!</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Emmanuel Aramendia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
